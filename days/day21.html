<!doctype html>
<html>
  <head>
    <script src="https://code.createjs.com/easeljs-0.8.0.min.js"> </script>
    <script src="https://code.createjs.com/tweenjs-0.6.2.min.js"> </script>
    <script src="https://cdn.socket.io/socket.io-1.2.0.js"> </script>
    <title>Canvas Animation</title>
    <style>
      #canvas {border: solid 1px black; background-color: lightblue;}
    </style>
  </head> 
  <body>
    <canvas id="canvas"></canvas><br>
    <script >
      var socket = io();
          stage = new createjs.Stage("canvas");
          canvas = document.querySelector('canvas');
          canvas.width = window.innerWidth-50;
          canvas.height = window.innerHeight-50;
      var vertical = 20;
      var horizontal = 20;      
      socket.on('user connected', function(UserName){
        var Userdata = {
              images: ["http://savepic.ru/13767000.png"],
              frames: {width: 120, height: 120, count: 24},
              animations: {sit: (Math.random() * (24 - 1) + 1)}
        };
        var user = {
          name: UserName,
          id: socket.id,
          data: Userdata
        };             
        var spriteSheet = new createjs.SpriteSheet(user.data);
        var sprite = new createjs.Sprite(spriteSheet, 1);
        stage.addChild(sprite);
        if (vertical < canvas.height-140){
          sprite.x = horizontal;
          sprite.y = vartical;
        }
        else {
          vertical = 20;
          horizontal += 120;
        }
        if (horizontal >= canvas.width-139){
          sprite.x = horizontal;
          sprite.y = vartical;
        }
        vertical += 120;
        createjs.Ticker.addEventListener("tick", onTickHandler);
      });
          
      
        function onTickHandler(evt) {   
            stage.update();
          };
          window.addEventListener('resize', onResize, false);
            onResize();
            function onResize() {
              canvas.width = window.innerWidth-50;
              canvas.height = window.innerHeight-50;
            };
          socket.on('button clicked', function(value){
            sprite.x += value;        
          });
    </script>
  </body>
</html>
